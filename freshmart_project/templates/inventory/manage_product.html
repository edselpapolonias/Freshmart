{% load widget_tweaks %}
{% include "partials/header.html" %}
<body class="sb-nav-fixed">
{% include "partials/navbar.html" %}

<div id="layoutSidenav">
    {% include "partials/sidebar.html" %}
    <div id="layoutSidenav_content">
        <main>
            <div class="container mt-4">
                <h2 class="mb-4">{% if edit_mode %}Edit Product{% else %}Add Product{% endif %}</h2>

                <div class="card shadow-sm mb-4">
                    <div class="card-body">
                        <form method="POST">
                            {% csrf_token %}
                            <div class="row g-3">
                                <!-- Product Code -->
                                <div class="col-md-6">
                                    <label for="id_product_code" class="form-label">Product Code</label>
                                    {{ form.product_code|add_class:"form-control" }}
                                </div>

                                <!-- Product Name -->
                                <div class="col-md-6">
                                    <label for="id_product_name" class="form-label">Product Name</label>
                                    {{ form.product_name|add_class:"form-control" }}
                                </div>

                                <!-- Description -->
                                <div class="col-12">
                                    <label for="id_description" class="form-label">Description</label>
                                    {{ form.description|add_class:"form-control"|attr:"rows:3,placeholder:Enter description" }}
                                </div>

                                <!-- Price -->
                                <div class="col-md-6">
                                    <label for="id_price" class="form-label">Price (₱)</label>
                                    {{ form.price|add_class:"form-control" }}
                                </div>

                                <!-- Category -->
                                <div class="col-md-6">
                                    <label for="id_category" class="form-label">Category</label>
                                    {{ form.category|add_class:"form-control" }}
                                </div>

                                <!-- Buttons -->
                                <div class="col-12 text-end mt-3">
                                    {% if edit_mode %}
                                        <button type="submit" class="btn btn-success">Update Product</button>
                                        <a href="{% url 'product_manage' %}" class="btn btn-secondary">Cancel</a>
                                    {% else %}
                                        <button type="submit" class="btn btn-primary">Add Product</button>
                                    {% endif %}
                                </div>
                            </div> <!-- end of row -->
                        </form>
                    </div>
                </div>

                <hr>

                <h3 class="mt-4">Product List</h3>
                <div class="card">
                    <div class="card-body">
                        <table class="table table-bordered table-striped mt-2">
                            <thead class="table-dark">
                                <tr>
                                    <th>Product Code</th>
                                    <th>Product Name</th>
                                    <th>Description</th>
                                    <th>Stock</th>
                                    <th>Price</th>
                                    <th>Category</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in items %}
                                <tr>
                                    <td>{{ item.product_code }}</td>
                                    <td>{{ item.product_name }}</td>
                                    <td>{{ item.description }}</td>
                                    <td>{{ item.quantity_in_stock }}</td>
                                    <td>₱{{ item.price }}</td>
                                    <td>{{ item.category }}</td>
                                    <td>
                                        <a href="{% url 'product_detail' item.id %}" class="btn btn-info btn-sm">View</a>
                                        <a href="{% url 'product_edit' item.id %}" class="btn btn-warning btn-sm">Edit</a>
                                        <form method="POST" action="{% url 'product_edit' item.id %}" style="display:inline;">
                                            {% csrf_token %}
                                            <button type="submit" name="delete" class="btn btn-danger btn-sm"
                                                onclick="return confirm('Are you sure you want to delete this product?');">
                                                Delete
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                {% empty %}
                                <tr><td colspan="8" class="text-center">No products available.</td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>

        {% include "partials/footer.html" %}
    </div>
</div>

{% include "partials/scripts.html" %}
</body>
</html>
